<!DOCTYPE html>
<html lang="zh-CN" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ETF Hunter | è·¨å¢ƒä¸æœ¬åœŸ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gray: { 850: '#1f2937', 900: '#111827', 950: '#030712' }
                    }
                }
            }
        }
    </script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        [v-cloak] { display: none; }
    </style>
</head>
<body class="bg-gray-950 text-gray-100 font-sans antialiased min-h-screen pb-10">

<div id="app" v-cloak class="max-w-md mx-auto bg-gray-900 min-h-screen shadow-2xl relative border-x border-gray-800">
    
    <!-- é¡¶éƒ¨ -->
    <header class="sticky top-0 z-50 bg-gray-900/95 backdrop-blur border-b border-gray-800 p-4">
        <div class="flex justify-between items-center">
            <h1 class="text-xl font-black italic tracking-tighter bg-gradient-to-r from-indigo-400 to-cyan-400 bg-clip-text text-transparent">
                ETF HUNTER
            </h1>
            <div class="flex gap-2 text-xs font-mono text-gray-500">
                <span>Aè‚¡è§†è§’</span>
                <span class="text-gray-700">|</span>
                <span>å»å™ªå·¥å…·</span>
            </div>
        </div>
        
        <!-- æœç´¢æ¡† -->
        <div class="mt-4 relative">
            <input v-model="searchQuery" type="text" placeholder="æœä»£ç /åç§° (å¦‚: çº³æŒ‡, 300, 513100)" 
                   class="w-full bg-gray-800 text-white border border-gray-700 rounded-lg py-2.5 px-4 pl-10 focus:outline-none focus:border-indigo-500 transition-colors text-sm placeholder-gray-600">
            <svg class="w-4 h-4 text-gray-500 absolute left-3 top-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
        </div>
    </header>

    <!-- åˆ—è¡¨åŒº -->
    <div class="p-4 space-y-4">
        
        <!-- æ¯ä¸€ä¸ª ETF å¡ç‰‡ -->
        <div v-for="item in filteredList" :key="item.code" class="bg-gray-800 rounded-xl border border-gray-700/50 shadow-lg overflow-hidden group hover:border-gray-600 transition-all">
            
            <!-- å¡ç‰‡å¤´éƒ¨ï¼šé€šç”¨ä¿¡æ¯ -->
            <div class="px-4 py-3 flex justify-between items-start bg-gray-800/80">
                <div>
                    <div class="flex items-center gap-2">
                        <span class="text-lg font-bold text-gray-100">{{ item.name }}</span>
                        <!-- æ ‡ç­¾åŒºåˆ† -->
                        <span v-if="item.type === 'cross'" class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400 border border-purple-500/20">è·¨å¢ƒ QDII</span>
                        <span v-else class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-blue-500/10 text-blue-400 border border-blue-500/20">æœ¬åœŸ A-Share</span>
                    </div>
                    <div class="text-xs text-gray-500 font-mono mt-0.5">{{ item.code }}</div>
                </div>
                <div class="text-right">
                    <div class="text-lg font-mono font-medium" :class="item.pct_chg >= 0 ? 'text-red-400' : 'text-green-400'">
                        {{ item.price }}
                    </div>
                    <div class="text-xs font-mono" :class="item.pct_chg >= 0 ? 'text-red-400' : 'text-green-400'">
                        {{ item.pct_chg >= 0 ? '+' : ''}}{{ item.pct_chg }}%
                    </div>
                </div>
            </div>

            <!-- æ ¸å¿ƒå·®å¼‚åŒ–åˆ†æåŒº -->
            <div class="px-4 pb-4 pt-1">
                
                <!-- åœºæ™¯ A: è·¨å¢ƒ ETF (å±•ç¤ºæº¢ä»·ä¸å½±å­) -->
                <div v-if="item.type === 'cross'" class="space-y-2">
                    <!-- æº¢ä»·è­¦å‘Šæ¡ -->
                    <div class="flex items-center justify-between p-2 rounded bg-gray-900/50 border border-gray-700/30">
                        <span class="text-xs text-gray-400">å®æ—¶æº¢ä»·ç‡</span>
                        <div class="flex items-center gap-2">
                            <span v-if="item.quota_status === 'closed'" class="text-[10px] px-1 rounded bg-red-500/20 text-red-400">æš‚åœç”³è´­</span>
                            <span class="font-mono font-bold text-sm" :class="getPremiumColor(item.premium_rate)">
                                {{ item.premium_rate > 0 ? '+' : ''}}{{ item.premium_rate }}%
                            </span>
                        </div>
                    </div>

                    <!-- å½±å­å‡€å€¼é€»è¾‘ -->
                    <div class="flex items-center justify-between text-xs">
                        <span class="text-gray-500">å½±å­å‡€å€¼ (å«æœŸè´§):</span>
                        <span class="font-mono text-gray-300">{{ item.shadow_nav }}</span>
                    </div>
                    
                    <!-- æ™ºèƒ½ç‚¹è¯„ -->
                    <div class="mt-2 text-[10px] p-2 rounded bg-gray-700/20 text-gray-400 leading-relaxed">
                        <span class="text-indigo-400 font-bold">ğŸ’¡ åˆ†æ: </span>
                        <span v-if="item.premium_rate > 3 && item.quota_status === 'closed'">
                            é¢åº¦å·²æ»¡ä¸”æº¢ä»·è¿‡é«˜ï¼Œå­˜åœ¨å¤§å¹…å›è°ƒé£é™©ï¼Œåˆ‡å‹¿è¿½é«˜ã€‚
                        </span>
                        <span v-else-if="item.premium_rate < 0">
                            å½“å‰å‡ºç°æŠ˜ä»·ï¼Œé€‚åˆæ—¥å†…å¥—åˆ©æˆ–é…ç½®ã€‚
                        </span>
                        <span v-else>ä»·æ ¼å¤„äºåˆç†åŒºé—´ï¼Œè·Ÿéšç¾è‚¡èµ°åŠ¿ã€‚</span>
                    </div>
                </div>

                <!-- åœºæ™¯ B: æœ¬åœŸ ETF (å±•ç¤ºä¼°å€¼ä¸èµ„é‡‘æµ) -->
                <div v-else class="space-y-3 pt-1">
                    
                    <!-- 1. èµ„é‡‘æµå‘ (æ ¸å¿ƒå»å™ªæŒ‡æ ‡) -->
                    <div class="flex justify-between items-center bg-gray-900/50 p-2 rounded border border-gray-700/30">
                        <div class="flex flex-col">
                            <span class="text-[10px] text-gray-500">ä¸»åŠ›èµ„é‡‘æ„å›¾</span>
                            <div class="flex items-center gap-1 mt-0.5">
                                <span class="text-xs font-bold" 
                                      :class="item.fund_flow_val.includes('+') ? 'text-red-400' : 'text-green-400'">
                                    {{ item.fund_flow_val }}
                                </span>
                                <!-- èƒŒç¦»ä¿¡å·å¾½ç«  -->
                                <span v-if="item.is_divergence" class="text-[9px] px-1 py-0.5 rounded bg-yellow-500/20 text-yellow-500 border border-yellow-500/30 animate-pulse">
                                    ğŸ”¥ åº•éƒ¨èƒŒç¦»
                                </span>
                            </div>
                        </div>
                        <div class="text-right flex flex-col items-end">
                            <span class="text-[10px] text-gray-500">æ‹¥æŒ¤åº¦</span>
                            <span class="text-xs font-mono text-gray-300">{{ item.crowdedness }}%</span>
                        </div>
                    </div>

                    <!-- 2. ä¼°å€¼æ¸©åº¦è®¡ -->
                    <div>
                        <div class="flex justify-between text-[10px] text-gray-500 mb-1">
                            <span>ä¼°å€¼åˆ†ä½: {{ item.valuation_percentile }}%</span>
                            <span :class="getValuationColor(item.valuation_percentile)">
                                {{ getValuationText(item.valuation_percentile) }}
                            </span>
                        </div>
                        <div class="h-1.5 w-full bg-gray-700 rounded-full overflow-hidden">
                            <div class="h-full rounded-full transition-all duration-500" 
                                 :class="getValuationBarColor(item.valuation_percentile)"
                                 :style="`width: ${item.valuation_percentile}%`">
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        
        <!-- ç©ºçŠ¶æ€ -->
        <div v-if="filteredList.length === 0" class="text-center py-10 text-gray-600 text-sm">
            æœªæ‰¾åˆ°ç›¸å…³ ETFï¼Œè¯•è¯•æœ "300" æˆ– "çº³æŒ‡"
        </div>

    </div>
</div>

<script>
<!-- å¼•å…¥ Supabase å®˜æ–¹åº“ -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
    const { createApp, ref, computed, onMounted } = Vue

    // ğŸ”¥ å¡«å…¥ä½ çš„ Supabase å¯†é’¥
    const SUPABASE_URL = 'https://wrlhrwqhxomfjepvzfai.supabase.co' 
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndybGhyd3FoeG9tZmplcHZ6ZmFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU1MjIyNjIsImV4cCI6MjA4MTA5ODI2Mn0.moNJty0hBJrxXK6j_DfI-hyCuWvLT5xg39tDZb1iLbs'
    
    // ä¿®æ­£ï¼šè¿™é‡Œè¦æŠŠ show æ”¹æˆ window.supabase
    // å¹¶ä¸”æŠŠå˜é‡å supabase æ”¹æˆ supabaseClient ä»¥å…åå­—å†²çª
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY)

    createApp({
        setup() {
            const searchQuery = ref('')
            const assets = ref([]) 

            const fetchData = async () => {
                // æ³¨æ„ï¼šè¿™é‡Œç”¨ supabaseClient
                const { data, error } = await supabaseClient
                    .from('etf_assets')
                    .select('*')
                
                if (error) {
                    console.error('å‡ºé”™äº†:', error)
                } else {
                    assets.value = data
                }
            }

            onMounted(() => {
                fetchData()
                
                // å¼€å¯å®æ—¶è®¢é˜…
                supabaseClient
                    .channel('etf_realtime')
                    .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'etf_assets' }, payload => {
                        const index = assets.value.findIndex(x => x.code === payload.new.code)
                        if (index !== -1) {
                            assets.value[index] = payload.new
                        }
                    })
                    .subscribe()
            })
            
            // ... (ä¸‹é¢çš„ getPremiumColor ç­‰å‡½æ•°ä¸ç”¨å˜ï¼Œä¿æŒåŸæ ·) ...
</script>
</script>

</body>
</html>